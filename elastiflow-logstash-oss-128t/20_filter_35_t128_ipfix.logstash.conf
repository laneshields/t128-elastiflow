filter {

  ## Is this a first flow record
  #if [ipfix][t128StartTime] == [ipfix][t128EndTime] {
  #  # The reverse flow probably doesn't have any packets yet
  #  if [ipfix][t128ForwardPacketCount] == 0 {
  #    mutate {
  #      replace => { "[flow][direction]" => "reverse" }
  #    }
  #  } else {
  #    mutate {
  #      replace => { "[flow][direction]" => "forward" }
  #    }
  #  }
  #} else {
  #  # Try to look up what we figured out last time
  #  elasticsearch {
  #    query => "[ipfix][t128SessionId]:%{[ipfix][t128SessionId]} AND [ipfix][sourceIPv4Address]:%{[ipfix][sourceIPv4Address]}"
  #    fields => { "flow" => "old_flow" }
  #    index => "elastiflow-4.0.0-%{+YYYY.MM.dd}"
  #  }
  #  if [flow][prev_dir] {
  #    mutate {
  #      replace => { "[flow][direction]" => "%{[flow][prev_dir]}" }
  #    }
  #  }
  #}

  if [ipfix][t128ServiceName] {
    mutate {
      copy => { "[ipfix][t128ServiceName]" => "[network][application]" }
    }
    mutate {
      copy => { "[ipfix][t128ServiceName]" => "[flow][application]" }
    }
  } else if [ipfix][t128SessionType] {
    mutate {
      copy => { "[ipfix][t128SessionType]" => "[network][application]" }
    }
  }

  mutate {
    copy => { "[ipfix][t128RouterName]" => "[node][hostname]" }
  }

  mutate {
    copy => { "[source][ip]" => "[flow][client_addr]" }
  }

  mutate {
    copy => { "[source][ip]" => "[flow][client_hostname]" }
  }

  mutate {
    copy => { "[destination][ip]" => "[flow][server_addr]" }
  }

  mutate {
    copy => { "[destination][ip]" => "[flow][server_hostname]" }
  }

  mutate {
    copy => { "[network][bytes]" => "[flow][bytes]" }
  }

  mutate {
    copy => { "[network][packets]" => "[flow][packets]" }
  }
}
